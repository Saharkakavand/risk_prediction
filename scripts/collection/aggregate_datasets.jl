"""
This is a script that aggregates the datasets generated by a set of dataset 
collectors. It should typically not be necessary to run this.
"""

using AutoRisk

# collect full datasets
basedir = "../../data/datasets/may/"
input_filepaths = [
    "ngsim_1_sec_traj_1.h5",
    "ngsim_1_sec_traj_2.h5",
    "ngsim_1_sec_traj_3.h5",
    "ngsim_1_sec_traj_4.h5",
    "ngsim_1_sec_traj_5.h5",
    "ngsim_1_sec_traj_6.h5",
    ]
input_filepaths = [string(basedir, f) for f in input_filepaths]
output_filepath = "../../data/datasets/may/ngsim_1_sec.h5"

valid_filepaths = Array{String}(0)
for filepath in input_filepaths
    try
        h5open(filepath, "r") do file
        end
        push!(valid_filepaths, filepath)
    catch e
    	println("invalid filepath: $(filepath)")
        println("exception: $(e)")
    end
end

if length(valid_filepaths) > 0
    aggregate_datasets(valid_filepaths, output_filepath)
else
    println("no valid filepaths")
end